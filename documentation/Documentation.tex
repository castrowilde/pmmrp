\documentclass[12pt,leqn]{article}

\title{Обработка на изображения чрез реакционно-дифузни модели}
\author{Пламен Никифоров, Християн Марков, Стефан Велинов}
\date{\today}

\usepackage[T2A]{fontenc}
\usepackage{amsmath,cmap}
\usepackage[cp1251]{inputenc}
\usepackage[english,bulgarian]{babel}
\usepackage{graphicx}
\usepackage{float}
\usepackage{subcaption}
\usepackage{listings}
\usepackage{geometry}
\usepackage{soul}
%\usepackage{hyperref}

\begin{document}
\maketitle
\begin{abstract}
  В настоящата работа е описан подход за обработка на изображения с използване на реакционно-дифузионен модел.
  Разгледани са отделните компоненти на модела и тяхното поведение. Направени са примери и са изложени резултати.
\end{abstract}
\tableofcontents
%\newpage

\section{Въведение}

В този проект се запознаваме и реализираме няколко метода за обработка на изображения, предложени от Ebihara et.al \cite{imgprocessing}. Използвайки реакционно-дифузен модел (и по-конкретно този на Fitz-Hugh \& Nagumo) при условията на Тюрингова неустойчивост \cite{turinginstability} могат да се намерят ръбове на обекти, да се сегментират изображения, да се намали шумът и да се увеличи контрастът. Въпреки наличието на други подходи (като например \textit{Скрит модел на Марков} \cite{hmm}, невронни мрежи и обработка с уейвлети), реакционно-дифузният е също толкова гъвкав и приложим, дори предпочитан, заради по-малкото необходими изчисления.
В сравнение с част от конвенционалните техники, посочени по-горе, разглежданиата тук дава добри резултати и при наличие на шум.

Всички тестове и симулации са извършени с MATLAB.

Проектът е изготвен във връзка с дисциплината \textit{Приложения на математиката за моделиране на реални процеси}.

Настоящият доклад е структуриран както следва: В параграф 2 запознаваме читателя с процеса дифузия и законите, които го описват. Параграф 3 е посветен на явлението реакция  и поведението на елементите в него. Изследването на реакционно-дифузните системи е засегнато в параграф 4, заедно с неустойчивостта на Тюринг. В параграф 5 представяме модела на FitzHugh-Nagumo и коефициентите, които ще използваме за нашия проект. В шести параграф се занимаваме с числено решаване на дифузионния и реакционния член. Представяме и диференчна схема. Началните условия и конкретни резултати са описани в параграф 7. Накрая на доклада има Приложение, в което са дадени код и допълнителни фигури, показващи резултатите.

\section{Дифузия}
Нека първо добием представа какво представлява дифузията. Най-просто казано дифузията е
процес, при който някакво вещество или енергия се разпространява от зони с по-висока концентрация,
към такива с по-ниска. Това явление се подчинява на едни и същи закони, независимо от същността на пренасяното вещество. За да стане по-ясно как точно работи дифузията, разглеждаме
следните примери:

\begin{enumerate}
\item Представете си, че имаме метален прът и започнем да нагряваме
единия му край. Нагрятият край ще има по-висока концентрация на топлина и посредством дифузията, топлината
ще започне да се пренася по дължината на пръта към края с по-ниска концентрация на топлина, до достигане на равновесно положение, в което ще имаме една и съща температура по целия прът.

\item Нека имаме аквариум пълен с вода. Пускайки количество мастило в аквариума, ние увеличаваме концентрацията на мастило там, където сме го пуснали, спрямо останалата част на аквариума. Мастилото ще започне да се разнася към тези части с по-ниска концентрация до достигане на положение, в което концентрацията на мастило във водата е равномерно разпределена.
\end{enumerate}

Вече имайки тази интуитивна представа за това какво представлява дифузията, нека разгледаме процеса по-строго, от научна гледна точка, и да го опишем математически. За да постигнем тази цел, ще трябва да разгледаме \textit{Закона за запазване} и \textit{Закона на Фик}.

\subsection{Закон за запазване}

Да си представим, че наблюдаваме поток на някакво вещество, преминаващо по безкрайно тънка тръба. Също така можем да наблюдаваме и концентрацията на веществото във фиксирани част на тръбата и време. Нека разгледаме потока и концентрацията като функции на времето и пространството (при нас едномерно, понеже разглеждаме безкрайно тънка тръба), т.е. $j(x,t)$ - поток, $u(x,t)$ - концентрация.

\begin{figure}[H]
\label{fig:fickslaw}
\includegraphics[scale=1]{law1.png}
\caption{Поток на вещество в едномерния случай}
\end{figure}

Искаме разликата на потока през дадена точка $x$ и потока в точка $x+E$ да е равна на изменението в концентрацията във всички точки в интервала $[x,x+E]$ (вж. Фиг.1). Така получаваме
\textit{Закон за запазване} в интегрална форма:

$$j(x,t)-j(x+E,t)=\int_{x}^{x+E}\frac{\partial u}{\partial t}\mathrm{dx}.$$

Приближаваме интеграла, като използваме квадратурна формула на правоъгълника
$\int_{a}^{b}f(x)\mathrm{dx}=(b-a)f\left(\frac{a+b}{2}\right)+O((b-a)^3)$ и получаваме:

\begin{align*}
j(x,t)-j(x+E,t)&=E\frac{\partial u}{\partial t} \Big(x+\frac{E}{2},t \Big)+O(E^3),\\
\frac{j(x,t)-j(x+E,t)}{E} &= \frac{\partial u}{\partial t} \Big(x+\frac{E}{2},t \Big)+O(E^2).
\end{align*}

След граничен преход $E \to 0$, получаваме \textit{Закон за запазване} в диференциална форма:

\begin{equation}\label{eq:zapazvane}
-\frac{\partial j}{\partial x}(x,t) = \frac{\partial u}{\partial t}(x,t).
\end{equation}

\subsection{Закон на Фик}

Законът на Фик ни дава връзка между дифузионния поток на едно вещество и неговата концентрация:

\begin{equation}\label{fickslaw2}
  j=-D\frac{\partial u}{\partial x},
\end{equation}



където $j$ е дифузионният поток, $D$ е дифузионният кеофициент, а $u$ е концентрацията на веществото. Използвайки Закона на Фик и Закона за запазване \ref{eq:zapazvane}, можем да изведем уравнението на дифузията:

\begin{equation}\label{eq:diffusion}
\frac{\partial u}{\partial t}(x,t)=D\frac{\partial^2u}{\partial x^2}(x,t).
\end{equation}


\subsection{Резултати от използване на чиста дифузия}
Използвайки уравнението на дифузията върху черно-бяло изображение с шум, очакваме като резултат да получим изчистване на шума за определени стойности на времето $t$, след което изображението да придобие хомогенен цвят (някакъв нюанс на сивото).

\begin{figure}[H]
\centering
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{diff1.png}
    \label{fig:baseimgdiff}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{diff2.png}
    \label{fig:biimgdiff}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{diff3.png}
    \label{fig:monoimgdiff}
\end{subfigure}
\caption{Резултати от обработката на изображение с дифузия}
\label{fig:diffonly}
\end{figure}

Решавайки уравнението на дифузията (\ref{eq:diffusion}) с начално условие първото изображението от Фиг.$2$, получаваме последното изображение от Фиг.$2$. Средната фигура показва една от итерациите, при която обектът още е ясно различим от фона, но дифузията е започнала да премахва ясно дефинираните ръбове. Резултантното изображение е размазано, почти навсякъде сме получили еднакъв нюанс на сивото.

\section{Реакция}

Използвайки само дифузия, единственото нещо, което ще постигнем, е достигане на хомогенно изображение (някакъв нюанс на сивото, понеже ще обработваме черно-бели изображения). За да постигнем останалите цели на проекта -- сегментация (разграничаване на фигура и фон) и намиране на ръбове, ще трябва да контролираме по някакъв начин дифузионния процес. Това ще постигнем, добавяйки реакционен член към уравнението на дифузията. За тази цел разглеждаме двукомпонентна система от активатор и инхибитор с концентрации, означени съответно с $u$ и $v$.

%\begin{equation}\notag
%\begin{split}
%\frac{\partial u}{\partial t}(x,t) &= D_u\frac{\partial^2u}{\partial x^2}(x,t)+u(1-u)(u-a)-v\\
%\frac{\partial v}{\partial t}(x,t) &= D_v\frac{\partial^2v}{\partial x^2}(x,t)+u - bv
%\end{split}
%\end{equation}
%
%Добавяйки реакционния член, ние променяме поведението на системата.
%
%\subsection{Поведение на елементите}\label{ch:elem}

В нашия случай елементите (пикселите на изображението) са разпределени в мрежа. Ще приемем, че всеки елемент се състои от две субстанции. Едната е активаторът, а другата е инхибиторът.
%При равновесно състояние, концентрациите на двете субстанции не се изменят, т.е. системата е в покой. Но, при добавяне на дори малък стимул, равновесието се губи. Ако стимулът е над определена граница, концентрацията на активатора се увеличава автоматично с времето.

%Сега ще разгледаме поведението на модела в равновеснo състояние $( \frac{\partial u}{\partial t} = 0, \frac{\partial v}{\partial t} = 0)$, без да прилагаме дифузията (т.е. $D_u = 0, D_v = 0$). Тогава получаваме следните нулеви изоклини (фиг. (2)):

Нашата цел ще бъде въведената реакционна част да има следното поведение:
\begin{enumerate}
  \item Да има две устойчиви равновесни точки които да отговарят на обект/фон за да можем да получим сегментация на изображението т.е. да можем след приключване на процеса ясно да разграничим обект от фон.
  \item Да имаме една устойчива равновесна точка, за да можем, спирайки процеса в подходящ момент(този момент остановихме експериментално) да извлечем контура на обекта.
\end{enumerate}

Една известна система, която има такова поведение, е системата на FitzHugh-Nagumo \cite{fhn1} \cite{fhn2}.
Тя има вида
\begin{equation}\label{react}
\begin{split}
   \frac{\partial u}{\partial t}&=u(1-u)(u-a)-v \\
   \frac{\partial v}{\partial t}&=u-bv
\end{split}
\end{equation}
Тогава нулевите изоклини на системата са определени с:

\begin{equation}\label{eq:reaction}
\begin{split}
v &= u (1 - u)(u - a),\\
v &= (1/b)u.
\end{split}
\end{equation}

\begin{figure}[H]
\centering
\begin{subfigure}[b]{0.5\textwidth}
    \includegraphics[scale=0.3]{Capturemonostable.png}
    \caption{Моноустойчива система}
\end{subfigure}
\begin{subfigure}[b]{0.5\textwidth}
    \includegraphics[scale=0.3]{Capturebistable.png}
    \caption{Двуустойчива система}
\end{subfigure}
\caption{Изоклини на уравненията на модела на FitzHugh-Nagumo}
\label{fig:nullclines}
\end{figure}

В зависимост от коефициентите $a$ и $b$, броят равновесни точки на системата ({\ref{eq:reaction}}) се мени.При $(1-a)^2-4(a+b^{-1})\geq 0$ имаме две устойчиви равновесни точки, а при $(1-a)^2-4(a+b^{-1})< 0$ една. При наличието на единствена устойчива точка (Фиг. {\ref{fig:nullclines}} (а)), прилагайки стимул към елемента, състоянието му се променя, но в крайна сметка се връща към устойчивост, следвайки стрелките. От друга страна, двуустойчивата система (Фиг. {\ref{fig:nullclines}} (б)) има три равновесни точки $A, B, C$. В този случай, ако стимулът прати елемента над границата $(u > a, v = 0)$, то той се установява в състояние $B$; ако стимулът е под границата $(u < a, v = 0)$, отива в $A$. Точка $C$ е неустойчива равновесна точка.
Това поведение на елементите е от голяма полза, защото при промяна само на параметрите $a$ и $b$ ще получим два напълно различни резултата - отделяне на обекта и намиране на ръбове.

\begin{figure}[H]
\centering
\includegraphics[scale=0.3]{evolutions.png}
\caption{Разликата в поведението при добавяне на различни стойности на стимула}
\label{fig:evolutions}
\end{figure}

Фигура \ref{fig:evolutions} изобразява разликата в поведението на моноустойчивата система, в зависимост от началното условие. При $u_0 > a, v_0 = 0$, орбитите имат поведение, подобнo на (1), а накрая $u$ и $v$ достигат състоянието $A$. В другия случай $(u_0 < a, v = 0)$, орбитата наподобява (2). Така откриваме, че параметърът $a$ от (\ref{eq:1}) действа като граница (\textit{threshold}).


\section{Реакционно-дифузни системи. Неустойчивост на Тюринг}

Реакционно-дифузните системи са математически модели, които описват различни физически явления, едно от които е промяната във времето и пространството на конценцтрацията на едно или повече вещества. Локални реакции карат субстанциите да се изменят една към друга, а дифузията ги разпространява из пространството.

Двукомпонентните системи позволяват описване на много по-голям диапазон феномени, за разлика от еднокомпонентния си аналог. Една от най-важните идеи, свързани с тях, е предложена от Алан Тюринг. Той твърди, че едно състояние, което е устойчиво в локална система, може да изгуби това си качество при наличието на дифузия. За да стигнем до устойчиво състояние трябва да наложим някакво условие върху дифузионните коефициенти $(D_u \ll D_v)$ което имаме от неустойчивоста на Тюринг. По този начин ние разппространяваме инхибитора по-бързо, което ограничава активатора и получаваме устойчивост на системата.

Разглежданите в този проект системи са активатор-инхибиторните, в които един компонент стимулира собственото си и на другите компоненти възпроизвеждане, а другия инхибира (възпира) растежа им. Най-известният представител е уравнението на FitzHugh-Nagumo, който е представен в параграф \ref{sec:FHN}.
%
%\begin{equation}
%\begin{split}
%\partial_t u &=  d_u^2 \nabla^2u + f(u) - \sigma \upsilon, \\
%\tau \partial_t \upsilon &= d_\upsilon^2 \nabla^2\upsilon + u - \upsilon,
%\end{split}
%\end{equation}
%където $d_u, d_v, \tau, \sigma, \lambda$ са положителни константи.

\section{Постановка на задачата}

\subsection{Модел на FitzHugh-Nagumo}\label{sec:FHN}

Моделът на FitzHugh-Nagumo (FHN) \cite{fhn1} \cite{fhn2} е опростена версия на модела на Hodgkin-Huxley \cite{hodgkinhuxley}, който описва детайлно активацията и деактивацията на неврони.

Този модел се задава чрез уравненията

\begin{equation}
\begin{split}
\frac{\partial u}{\partial t} &= D_{u} \nabla^2 u + \frac{1}{\varepsilon}\cdot (u(1-u)(u-a)-v),\label{eq:1}\\
\frac{\partial v}{\partial t} &= D_{v} \nabla^2 v + u -bv,
\end{split}
\end{equation}
където $u$ и $v$ са концентрациите на активатор и инхибитор, $D_u$ и $D_v$ са съответните коефициенти на дифузия, а $\varepsilon \, (0 < \varepsilon << 1), a \, (0 < a < 0.5)$ и $b \, (b > 0)$ са константни параметри.

\subsection{Оформяне на образи от реакционно-дифузния модел}

Субстанциите (активатор и инхибитор) се разменят между елементите, благодарение на дифузионната част на уравненията (\ref{eq:1}). Ако един елемент се включи, т.е. концентрациите на $u$ и $v$ се увеличат, той отделя голямо количество от тях към съседите си. Те от своя страна ги получават и също се включват, ако концентрациите на активатор и инхибитор също са над границата.

Подобен феномен се наблюдава и в някои химични експерименти. Например, реакцията на Белусов-Жаботински \cite{belousov} се себеорганизира във формата на спирала или мишена. От подобни примери можем да заключим, че механизмът на Тюринговата неустойчивост $(D_u << D_v)$ е важно условие за устойчиво формиране на образи. При това условие $(D_u << D_v)$ ще представим няколко алгоритъма за обработка на изображения, като намиране на ръбове и сегментация.

\section{Числено решаване}\label{ch:mreja}

Ще дискретизираме областта, в която решаваме задачата, като въведем следната мрежа:

\begin{figure}[h]
\centering
\includegraphics[scale=0.7]{diffscheme.png}
\caption{Диференчна схема, използвана за числено решаване}
\label{fig:diffscheme}
\end{figure}

\subsection{Числена апроксимация на дифузионните членове}

За да решим уравнението на дифузията, използваме метод на крайните разлики, като приближаваме

\begin{equation}\notag
\frac{\partial^2 u}{\partial x^2}\approx \frac{u_{i+1}-2u_i+u_{i-1}}{h^2},
\end{equation}

където $h$ е дискретизираната стъпка по пространството, а $u_i$ е стойността на функцията в $i$-та позиция. Използвайки това приближение имаме грешка от порядък $O(h^2)$.


\subsection{Числено решаване на реакцията}

Нека разгледаме реакционната система.

\begin{equation}\notag
\begin{split}
\frac{\partial u}{\partial t} &= u(1-u)(u-a)-v,\\
\frac{\partial v}{\partial t} &= u - bv.
\end{split}
\end{equation}

Изхождайки от дефиницията за производна $\frac{\partial u }{\partial t}=\lim\limits_{\Delta t\rightarrow 0} \frac{u(x,t+\Delta t)-u(x,t)}{\Delta t}$, ако предположим, че $\Delta t$ е достатъчно малко, можем да премахнем граничния преход и да получим уравнение за стойността на функцията в момент $t+\Delta t$, зависещо от
стойността в момент $t$. Така получаваме:

\begin{equation}\notag
\begin{split}
u(x,t+\Delta t) &= \Delta t[u(1-u)(u-a)-v]-u,\\
v(x,t+\Delta t) &= \Delta t(u-bv)-v.
\end{split}
\end{equation}

\subsection{Диференчна схема}

За решаване на системата на FitzHugh-Nagumo използваме следната диференчна схема върху мрежата, въведена в \ref{ch:mreja}:

\begin{equation}\label{eq:ds}
\begin{split}
U^{k+1}_{i,j} &= \frac{\tau D_u}{h^2}(U^{k}_{i+1,j} + U^{k}_{i,j+1} + U^{k}_{i-1,j} + U^{k}_{i,j-1}) + \Big(1 - \frac{4 \tau D_u}{h^2} \Big) U^{k}_{i,j} + \\
&+ \tau \frac{1}{\varepsilon}[U^{k}_{i,j}(1 - U^{k}_{i,j}(U^{k}_{i,j} - a) - V^{k}_{i,j}],\\
V^{k+1}_{i,j} &= \frac{\tau D_v}{h^2}(V^{k}_{i+1,j} + V^{k}_{i,j+1} + V^{k}_{i-1,j} + V^{k}_{i,j-1}) + \Big(1 - \frac{4 \tau D_v}{h^2} \Big) V^{k}_{i,j} + \tau(V^{k}_{i,j} - b V^{k}_{i,j}),
\end{split}
\end{equation}
където $k$ е слоят по времето (т.е. поредната итерация), а $i$ и $j$ са координатите на елемента (пиксела) в мрежата на изображението.

За $\tau$ трябваше да поставим следното ограничение, произхождащо от ({\ref{eq:ds}}), тъй като при много големи стойности получаваме неустойчива система:

\begin{equation}\notag
\tau = \text{min}\Big\{\frac{h^2}{4 + D_v - h^2(1 - b)}, \frac{h^2 \varepsilon}{4  \varepsilon  D_u + a h^2}\Big\}
\end{equation}

\section{Обработка на изображения. Числени експерименти}

\subsection{Начални условия}\label{subsec:nu}

Фигура \ref{fig:baseimg} показва черно-бялото изображение, с което ще работим. То е с размери $200\times200$ пиксела и представлява сив квадрат с черен фон. Стойността на пикселите в средата е между 153 и 202 от възможни 256 нива на сивото. Всеки елемент (пиксел) получава стойност на активатора чрез формулата
\begin{equation}\notag
u_0(x,y) = \{f(x,y) / 255\} \times (1 + 0.05) - 0.05,
\end{equation}
където $f(x,y)$ е стойността на пиксела в ниво на сивото $(f(x,y) \in [0,255])$.
За конкретния случай получаваме $u_0 = 0$ за фона (черния цвят) и $u_0 \in [0.58, 0.78]$ за обекта, т.е. сивия квадрат. Всички пиксели започват със стойност на инхибитора $v_0(x,y) = 0$. В симулацията ни, извършена на MATLAB, задаваме и $D_u << D_v$, за да бъде изпълнено условието на Тюрингова неустойчивост \cite{imgprocessing}. Параметрите $a$ и $b$ са така избрани, че да получим устойчива система - моно или двуустойчива.
Параметърът $\varepsilon$ контролира скоростта на $u$: при по-малки $\varepsilon$, $u$ расте по-бързо. Избрали сме $\varepsilon = 0.0006$ и разстояние между пикселите $h = 1$. За дифузионните коефициенти избрахме $D_u = 2, D_v = 8$, за да бъде изпълнено условието за неустойчивост на Тюринг.
%За $\tau$ трябваше да поставим следното ограничение, произхождащо от ({\ref{eq:ds}}), тъй като при много големи стойности получаваме неустойчива система:

\subsection{Резултати}
\subsubsection{Изображения без шум}
\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{img1.png}
    \caption{Базa}
    \label{fig:baseimg}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{imgbistable.png}
    \caption{Сегментация}
    \label{fig:biimg}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{imgmonostable.png}
    \caption{Намиране на ръбове}
    \label{fig:monoimg}
\end{subfigure}
\caption{Резултати от обработката на изображение}
\label{fig:imgs}
\end{figure}

Фигури \ref{fig:biimg} и \ref{fig:monoimg} показват резултатите от първата проведена симулация, използвайки коефициентите от (\ref{subsec:nu}). При $a = 0.5, b = 20$ разполагаме с двуустойчива система, т.е. Фиг. \ref{fig:biimg}. Пикселите, които са част от обекта са станали бели, а фоновите са останали черни (сегментация). При промяна на коефициента $b = 10$ системата става едноустойчива (Фиг. \ref{fig:monoimg}). Тук пикселите от вътрешността на изображението също са станали черни, оставяйки само контура бял, показвайки ясно ръбовете на обекта. Алгоритъмът е сравнително бърз, сегментирането отнема около 5 сек., а намирането на ръбове - 10 сек. Разликата се дължи на удвоения брой изчисления при моноустойчивата система (там необходими са ни 220 итерации, а за сегментацията 120).

\subsubsection{Изображения с шум}

Решихме да проверим поведението на модела при добавяне на шум в базовите изображения. На картинката от фигура \ref{fig:baseimg} е добавен поасонов шум, генериран от MATLAB. Забелязваме, че дебелината на линиите на изображението \ref{fig:noisemonoimg} е около 4-6px. Необходими са допълнителни изследвания за откриване на начин за допълнително изтъняване на ръбовете. На фигура \ref{fig:noisebiimg} се вижда също, че част от обекта е "изяден" (лявата страна). Отново, необходимо е допълнително проучване.

\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.37]{img2.png}
    \caption{Базa}
    \label{fig:noisebaseimg}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{denoising.png}
    \caption{Сегментация}
    \label{fig:noisebiimg}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{denoising2.png}
    \caption{Намиране на ръбове}
    \label{fig:noisemonoimg}
\end{subfigure}
\caption{Резултати от обработката на изображение}
\label{fig:noiseimgs}
\end{figure}


\newpage
\newgeometry{left=1cm, right=1cm, top=2cm, bottom=2cm}

\addcontentsline{toc}{section}{Приложение}
\section*{Приложение}

Приложението включва имплементация на модела (код на програмата MATLAB) и генерираните чрез него изображения, използвани в експериментите.

\subsection*{MATLAB код}
\begin{lstlisting}
A = imread('img.gif'); % load image
A = im2double(A); % scale pixel value from 0-255 to 0-1

h = 1/4; % x step
Du = 2; % diff coeff, Du << Dv or 4*Du = Dv
Dv = 8; % diff coeff
eps = 0.0006; % 0 < eps << 1
a = 0.5; % threshold
b = 20; % 10 for mono-stable, 20 for bi-stable
tau = min( h^2 / (4 + Dv - h^2 * (1-b)),
 h^2 * eps / (4 * eps * Du + a * h^2));

n = size(A,2); % image size horizontally
m = size(A,1); % image size vertically
L = 220; % number of layers (optimal 120 - 220)

% every pixel gets its own U value
U(1:m, 1:n,1) = A(1:m, 1:n) * (1.0 + 0.05) - 0.05;
% initial V is 0 for all pixels
V(1:m, 1:n,1) = zeros(m,n);

for k = 1:L
    for i = 2:m-1
        for j = 2:n-1

        U(i, j, k+1) = tau * Du / (h^2) * ( U(i+1, j, k) + U(i, j+1, k) + ...
        U(i-1, j, k) + U(i, j-1, k) ) + (1 - ( ( 4 * tau * Du) / h^2 )) * ...
        U(i, j, k) + tau * ( 1 / eps ) * ( U(i , j, k) * ...
        ( 1 - U(i, j, k) ) * ( U(i, j, k) - a) - V(i, j, k));

        V(i, j, k+1) = tau * Dv / (h^2) * ( V(i+1, j, k) + V(i, j+1, k) + ...
        V(i-1, j, k) + V(i, j-1, k) ) + (1 - ( ( 4 * tau * Dv) / h^2 )) * ...
        V(i, j, k) + tau * ( U(i , j, k) - b * V(i, j, k));

        end
    end

    imshow(U(:,:,k)); % show all the layers
    % show layer number
    set(gcf, 'name', ['layer ' num2str(k) ' of ' num2str(L)])
end
\end{lstlisting}

\subsection*{Допълнителни изображения}

\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{rose.png}
    \caption{Базa}
    \label{fig:noisebaseimg}
\end{subfigure}\\
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{rose2.png}
    \caption{Сегментация}
    \label{fig:noisebiimg}
\end{subfigure}\\
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.5]{rose3.png}
    \caption{Намиране на ръбове}
    \label{fig:noisemonoimg}
\end{subfigure}
\caption{Резултати от обработката на изображение с повече детайли и фон с повече от един нюанс\\Източник: https://www.pexels.com/}
\label{fig:noiseimgs}
\end{figure}

Решихме да изпробваме модела и с по-сложно изображение - такова с повече от един нюанс във фона и/или обекта. Използвани са същите коефициенти както при първоначалните тестове ($a = 0.5, b = 10$ за намиране на ръбове, $a = 0.5, b = 20$ за сегментация).  Моделът ясно разграничава обекта от фона, с леки затруднения, заради сенките, но смятаме, че резултатът е повече от приемлив.

\restoregeometry
\clearpage% or cleardoublepage
\addcontentsline{toc}{section}{Литература}

\begin{thebibliography}{8}
\bibitem{imgprocessing}
Mayumi Ebihara, Hitoshi Mahara, Tatsunari Sakurai, Atsushi Nomura, Hidetoshi Miike (2002),
\textit{Image Processing by a Discrete Reaction-Diffusion System}
\bibitem{turinginstability}
Szili L., Toth J. (1997)
\textit{On the origin of Turing instability}
\bibitem{belousov}
Zhang, Dongmei; Gyorgyi, Laszlo; Peltier, William R. (1993),
\textit{Deterministic chaos in the Belousov–Zhabotinsky reaction: Experiments and simulations. Chaos: an Interdisciplinary Journal of Nonlinear Science}
\bibitem{fhn1}
FitzHugh R. (1955),
\textit{Mathematical models of threshold phenomena in the nerve membrane}
\bibitem{fhn2}
Nagumo J., Arimoto S., and Yoshizawa S. (1962),
\textit{An active pulse transmission line simulating nerve axon}
\bibitem{hodgkinhuxley}
Hodkin A.L., Huxley A.F. (1952),
\textit{A quantitative description of membrane current and its application to conduction and excitation in nerve}
\bibitem{hmm}
Warakagoda N.,
%\href{http://jedlik.phy.bme.hu/~gerjanos/HMM/node2.html}
{\textit{Hidden Markov Models}}
\end{thebibliography}
\end{document}
