\documentclass[12pt,leqn]{article}

\title{Обработка на изображения чрез реакционно-дифузни модели}
\author{Пламен Никифоров, Християн Марков, Стефан Велинов}
\date{\today}

\usepackage[T2A]{fontenc}
\usepackage{amsmath,cmap}
\usepackage[cp1251]{inputenc}
\usepackage[english,bulgarian]{babel}
\usepackage{graphicx}
\usepackage{float}
\usepackage{subcaption}


\begin{document}
\maketitle

\tableofcontents
%\newpage

\section{Въведение}

В този проект се запознаваме с и реализираме няколко метода за обработка на изображения, предложени от Ebihara et.al \cite{imgprocessing}. Използвайки реакционно-дифузен модел (и по-конкретно този на Fitz-Hugh \& Nagumo) при условията на Тюрингова нестабилност могат да се намерят ръбове на обекти, да се сегментират изображения, намалява шума и увеличава контраста.
В сравнение с конвенционалните модели, разглежданият тук дава по-добри резултати при наличие на шум.

Всички тестове и симулации са извършени с MATLAB.

Проектът е изготвен във връзка с дисциплината \textit{Приложения на математиката за моделиране на реални процеси}.

\section{Дифузия}
Нека първо добием представа какво представлява дифузията. Най-просто казано дифузията е
процес, при който някакво вещество или енергия се разпространява от зони с по-висока концентрация,
към такива с по-ниска. Това явление се подчинява на едни и същи закони, независимо от същността на пренасяното вещество. За да стане по-ясно как точно работи дифузията разглеждаме
следните примери:

\begin{enumerate}
\item Представете си, че имаме метален прът и започнем да нагряваме
единия му край. Нагрятият край ще има по-висока концентрация на топлина и посредством дифузията, топлината
ще започне да се пренася по дължината на пръта, към края с по-ниска концентрация на топлина, до достигане на равновесно положение в което ще имаме една и съща температура по целия прът.

\item Нека имаме аквариум пълен с вода. Пускайки количество мастило в аквариума, ние увеличаваме концентрацията на мастило там, където сме го пуснали спрямо останалата част на аквариума. Мастилото ще започне да се разнася към тези части с по-ниска концентрация, до достигане на положение, в което концентрацията на мастило във водата е равномерно разпределена.
\end{enumerate}

Вече имайки тази интуитивна представа за това какво представлява дифузията, нека разгледаме процеса по-строго от научна гледна точка и да го опишем математически. За да постигнем тази цел, ще трябва да разгледаме \textit{Закона за запазване на енергията} и \textit{Закона на Фик}.

\section{Реакция}

\section{Реакционно-дифузни системи}
Реакционно-дифузните системи са математически модели, които описват няколко физически явления: най-честосрещаният от които е промяната във времето и пространството на конценцтрацията на едно или повече вещества. Локални реакции карат субстанциите да се изменят една към друга, а дифузията ги разпространява из пространството.

Такива системи се използват предимно в химията, но могат да опишат и динамични процеси от други природни области. Примери могат да се намерят в биологията, геологията, физиката, екологията и т.н. Математически погледнато, реакционно-дифузните системи са линейни параболични частни диференциални уравнения. Решенията им пък описват различни поведения - например вълни, себе-организиращи се структури като ивици, шестоъгълници или по-сложни.

\subsection{Двукомпонентни системи}

Двукомпонентните системи позволяват описване на много по-голям диапазон феномени, за разлика от еднокомпонентния си аналог. Една от най-важните идеи, свързани с тях, е предложена от Алан Тюринг. Той твърди, че едно състояние, което е стабилно в локална система, може да изгуби това си качество при наличието на дифузия.

Разглежданите в този проект системи са активатор-инхибиторните, в които един компонент стимулира собственото си и на другите компоненти възпроизвеждане, а другия инхибира (възпира) растежа им. Най-известният представител е уравнението на FitzHugh-Nagumo, който е представен в \ref{sec:FHN}
%
%\begin{equation}
%\begin{split}
%\partial_t u &=  d_u^2 \nabla^2u + f(u) - \sigma \upsilon, \\
%\tau \partial_t \upsilon &= d_\upsilon^2 \nabla^2\upsilon + u - \upsilon,
%\end{split}
%\end{equation}
%където $d_u, d_v, \tau, \sigma, \lambda$ са положителни константи.

\section{Постановка на задачата}

\subsection{Модел на FitzHugh-Nagumo}\label{sec:FHN}

Моделът на FitzHugh-Nagumo (FHN) е опростена версия на модела на Hodgkin-Huxley, който описва детайлно активацията и деактивацията на неврони.

Този модел се задава чрез уравненията

\begin{equation}
\begin{split}
\frac{\partial u}{\partial t} &= D_{u} \nabla^2 u + \frac{1}{\varepsilon}\cdot u(1-u)(u-a)-v)\label{eq:1}\\
\frac{\partial v}{\partial t} &= D_{v} \nabla^2 v + u -bv,
\end{split}
\end{equation}
където $u$ и $v$ са концентрациите на активатор и инхибитор, $D_u$ и $D_v$ са съответните коефициенти на дифузия, а $\varepsilon (0 < \varepsilon << 1), a (0 < a < 0.5)$ и $b (b > 0)$ са константни параметри.

Уравненията \ref{eq:1} определят поведението на $u$ и $v$ с течение на времето.

\subsection{Поведение на елементите}

В нашия случай, елементите (пикселите на изображението) са разпределени в мрежа. Всеки елемент се състои от две субстанции. Единият е активаторът, а другият е инхибиторът. При стабилно състояние, елементите крепят баланса на концентрациите на двете субстанции. Но, при добавяне на дори малък стимул, равновесието се губи. Ако стимулът е над определена граница, концентрацията на активатора се увеличава автоматично с времето.

Сега ще проверим поведението на модела в стабилно състояние $( \frac{\partial u}{\partial t} = 0, \frac{\partial v}{\partial t} = 0)$, без да прилагаме дифузията (т.е. $D_u = 0, D_v = 0$). Тогава получаваме следните изоклини:

\begin{equation}
\begin{split}
v &= u (1 - u)(u - a),\\
v &= (1/b)u
\end{split}
\end{equation}

\begin{figure}[H]
\centering
\begin{subfigure}[b]{0.5\textwidth}
    \includegraphics[scale=0.3]{Capturemonostable.png}
    \caption{Моноустойчива система}
\end{subfigure}
\begin{subfigure}[b]{0.5\textwidth}
    \includegraphics[scale=0.3]{Capturebistable.png}
    \caption{Двуустойчива система}
\end{subfigure}
\caption{Изоклини на уравненията на модела на FitzHugh-Nagumo}
\label{fig:nullclines}
\end{figure}

Фигура \ref{fig:nullclines} показва изоклините на уравненията в модела. Поведението на $u$ и $v$ е различно в зависимост от това в коя област са. В пресечната точка изменението на $u$ и $v$ е статично (те се зануляват едно друго). В зависимост от стойностите на константите $a$ и $b$, броят на устойчиви точки се мени и система показва различни типове. Един от тях е моноустойчивия (с една стабилна точка), другият е двуустойчивия (с две). При първия, състоянието се променя след добавяне на стимул, но в крайна сметка се връща към стабилно по посока на стрелките. От друга страна, двуустойчивата система има три устойчиви точки. Ако стимулът е над границата $(u > a, v = 0)$ елементът отива в състояние $B$, в другия случай $(u < a, v = 0)$ отива към $A$. В точка $C$ нямаме стабилност, затова тази точка се нарича нестабилна устойчива точка.

\begin{figure}[H]
\centering
\includegraphics[scale=0.3]{evolutions.png}
\caption{Разликата в поведението при добавяне на различни стойности на стимула}
\label{fig:evolutions}
\end{figure}

Фигура \ref{fig:evolutions} изобразява разликата в поведението на моноустойчивата система, при добавяне на различна стойност на стимула. При $u > a, v = 0$, орбитата стига линията (1), а накрая $u$ и $v$ достигат състоянието $A$. В другия случай $(u < a, v = 0)$, орбита стига линията (2). Така откриваме, че параметърът $a$ от (\ref{eq:1}) действа като граница (\textit{threshold}).

\subsection{Оформяне на образи от реакционно-дифузния модел}

Субстанциите (активатор и инхибитор) се разменят между елементите, благодарение на дифузионната част на уравненията (\ref{eq:1}). Ако един елемент се включи, т.е. концентрациите на $u$ и $v$ се увеличат, той отделя голямо количество от тях към съседите си. Те на своя страна ги получават и също се включват, ако концентрациите на активатор и инхибитор също са над границата.

Подобен феномен се наблюдава и в някои химични експерименти. Например, реакцията на Белусов-Жаботински се себеорганизира във формата на спирала или мишена. От подобни примери можем да заключим, че механизмът на Тюринговата нестабилност $(D_u << D_v)$ е важно условие за стабилно формиране на образи. При това условие $(D_u << D_v)$ ще представим няколко алгоритъма за обработка на изображения, като намиране на ръбове и сегментация.

\section{Обработка на изображения}

\subsection{Начални условия}

Фигура (\ref{fig:baseimg}) показва черно-бялото изображение, с което ще работим. То е с размери $200\times200$ пиксела и представлява сив квадрат с черен фон. Стойността на пикселите в средата е между 153 и 202 от възможни 256 нива на сивото. Всеки елемент (пиксел) получава собствена стойност на активатора чрез формулата
\begin{equation}
u_0(x,y) = \{f(x,y) / 255\} \times (1 + 0.05) - 0.05,
\end{equation}
където $f(x,y)$ е стойността на пиксела в ниво на сивото $(f(x,y) \in [0,255]$.
За конкретния случай получаваме $u_0 = 0$ за фона (черния цвят) и $u_0 \in [0.58, 0.78]$ за обекта, т.е. сивия квадрат. Всички пиксели започват със стойност на инхибитора $v_0(x,y) = 0$.

\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.4]{img1.png}
    \caption{Базa}
    \label{fig:baseimg}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.4]{imgbistable.png}
    \caption{Сегментация}
    \label{fig:biimg}
\end{subfigure}
\begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[scale=0.4]{imgmonostable.png}
    \caption{Намиране на ръбове}
    \label{fig:monoimg}
\end{subfigure}
\caption{Резултати от обработката на изображение}
\label{fig:imgs}
\end{figure}

В симулацията ни, извършена на MATLAB, задаваме $D_u << D_v$, за да бъде изпълнено условието на Тюрингова нестабилност. Параметрите $a$ и $b$ са така избрани, че да получим стабилна система - моно или двуустойчива. Параметърът $\varepsilon$ контролира скоростта на $u$: при по-малки $\varepsilon$, $u$ расте по-бързо. Избираме $\varepsilon = 0.0006$.

\subsection{Резултати}
Фигури (\ref{fig:biimg}) и (\ref{fig:monoimg}) показват резултатите от проведената симулация. Успешно сме реализирали сегментация и намиране на ръбове. Важно е да се отбележи, че коефициентите, използвани от модела, и по-конкретно $h$ - 'разстоянието' между пикселите, стойностите на дифузионните коефициенти $D_u$ и $D_v$, и стъпката по времето $\tau$ претърпяха редица промени. В крайна сметка се спряхме на $h = 1, D_u = 2, D_v = 8$. За $\tau$ трябваше да поставим следното ограничение:

\begin{equation}
\tau = \text{min}\Big\{\frac{h^2}{4 + D_v - h^2(1 - b)}, \frac{h^2 \varepsilon}{4  \varepsilon  D_u + a h^2}\Big\}
\end{equation}

\clearpage% or cleardoublepage
\addcontentsline{toc}{section}{Литература}
\begin{thebibliography}{1}
\bibitem{imgprocessing}
Mayumi Ebihara, Hitoshi Mahara, Tatsunari Sakurai, Atsushi Nomura, Hidetoshi Miike.
\textit{Image Processing by a Discrete Reaction-Diffusion System}, 2002
\end{thebibliography}
\end{document}
